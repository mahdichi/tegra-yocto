From 951997684c83f89872fa16e6c63b5fba03b80655 Mon Sep 17 00:00:00 2001
From: mahdichi <mahdichi@gmail.com>
Date: Wed, 6 Mar 2024 23:45:12 +0330
Subject: [PATCH] hardcode edid for 1080 25Hz

---
 nvidia/drivers/video/tegra/dc/edid.c | 30 +++++++++++++++++++++++++++-
 1 file changed, 29 insertions(+), 1 deletion(-)

diff --git a/nvidia/drivers/video/tegra/dc/edid.c b/nvidia/drivers/video/tegra/dc/edid.c
index e30662d4dd90..c7939b9d9ffa 100644
--- a/nvidia/drivers/video/tegra/dc/edid.c
+++ b/nvidia/drivers/video/tegra/dc/edid.c
@@ -60,6 +60,7 @@ struct tegra_edid_pvt {
 };
 
 /* 720p 60Hz EDID */
+/*
 static const char default_720p_edid[256] = {
 	0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00,
 	0x3a, 0xc4, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -94,6 +95,32 @@ static const char default_720p_edid[256] = {
 	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xca,
 };
+*/
+
+static const char default_720p_edid[256] = {
+	0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x05, 0xD7, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0xFF, 0x21, 0x01, 0x03, 0x80, 0x32, 0x1F, 0x78,
+	0x07, 0xEE, 0x95, 0xA3, 0x54, 0x4C, 0x99, 0x26, 0x0F, 0x50, 0x54, 0x00,
+	0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
+	0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x3E, 0x16, 0x80, 0xA0, 0x70, 0x38,
+	0x0F, 0x40, 0x30, 0x20, 0x35, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1A,
+	0x00, 0x00, 0x00, 0xFD, 0x00, 0x17, 0xF0, 0x0F, 0xFF, 0x06, 0x00, 0x0A,
+	0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x31,
+	0x39, 0x32, 0x30, 0x78, 0x31, 0x30, 0x38, 0x30, 0x20, 0x43, 0x56, 0x54,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x6B, 0x02, 0x03, 0x07, 0x00,
+	0x42, 0x21, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	0x00, 0x00, 0x00, 0x6F
+};
 
 #ifdef DEBUG
 static char tegra_edid_dump_buff[16 * 1024];
@@ -747,7 +774,7 @@ int tegra_edid_get_monspecs(struct tegra_edid *edid, struct fb_monspecs *specs)
 	struct tegra_edid_pvt *new_data, *old_data;
 	u8 checksum = 0;
 	u8 *data;
-	bool use_fallback = false;
+	bool use_fallback = true;
 
 	new_data = vzalloc(SZ_32K + sizeof(struct tegra_edid_pvt));
 	if (!new_data)
@@ -1117,3 +1144,4 @@ static void __exit tegra_edid_exit(void)
 
 module_init(tegra_edid_init);
 module_exit(tegra_edid_exit);
+
